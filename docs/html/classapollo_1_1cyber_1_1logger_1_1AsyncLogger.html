<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cyber-Cmake: apollo::cyber::logger::AsyncLogger Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cyber-Cmake
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespaceapollo.html">apollo</a></li><li class="navelem"><b>cyber</b></li><li class="navelem"><b>logger</b></li><li class="navelem"><a class="el" href="classapollo_1_1cyber_1_1logger_1_1AsyncLogger.html">AsyncLogger</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classapollo_1_1cyber_1_1logger_1_1AsyncLogger-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">apollo::cyber::logger::AsyncLogger Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Wrapper for a glog <a class="el" href="classapollo_1_1cyber_1_1logger_1_1Logger.html">Logger</a> which asynchronously writes log messages. This class starts a new thread responsible for forwarding the messages to the logger, and performs double buffering. Writers append to the current buffer and then wake up the logger thread. The logger swaps in a new buffer and writes any accumulated messages to the wrapped <a class="el" href="classapollo_1_1cyber_1_1logger_1_1Logger.html">Logger</a>.  
 <a href="classapollo_1_1cyber_1_1logger_1_1AsyncLogger.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="async__logger_8h_source.html">async_logger.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for apollo::cyber::logger::AsyncLogger:</div>
<div class="dyncontent">
<div class="center"><img src="classapollo_1_1cyber_1_1logger_1_1AsyncLogger__inherit__graph.png" border="0" usemap="#aapollo_1_1cyber_1_1logger_1_1AsyncLogger_inherit__map" alt="Inheritance graph"/></div>
<map name="aapollo_1_1cyber_1_1logger_1_1AsyncLogger_inherit__map" id="aapollo_1_1cyber_1_1logger_1_1AsyncLogger_inherit__map">
<area shape="rect" title="Wrapper for a glog Logger which asynchronously writes log messages. This class starts a new thread re..." alt="" coords="5,131,665,311"/>
<area shape="rect" title=" " alt="" coords="257,5,414,83"/>
</map>
</div>
<div class="dynheader">
Collaboration diagram for apollo::cyber::logger::AsyncLogger:</div>
<div class="dyncontent">
<div class="center"><img src="classapollo_1_1cyber_1_1logger_1_1AsyncLogger__coll__graph.png" border="0" usemap="#aapollo_1_1cyber_1_1logger_1_1AsyncLogger_coll__map" alt="Collaboration graph"/></div>
<map name="aapollo_1_1cyber_1_1logger_1_1AsyncLogger_coll__map" id="aapollo_1_1cyber_1_1logger_1_1AsyncLogger_coll__map">
<area shape="rect" title="Wrapper for a glog Logger which asynchronously writes log messages. This class starts a new thread re..." alt="" coords="5,131,665,311"/>
<area shape="rect" title=" " alt="" coords="257,5,414,83"/>
</map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ae1668301703ce3c01fe1fd2bf14c645c"><td class="memItemLeft" align="right" valign="top"><a id="ae1668301703ce3c01fe1fd2bf14c645c"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>AsyncLogger</b> (google::base::Logger *wrapped)</td></tr>
<tr class="separator:ae1668301703ce3c01fe1fd2bf14c645c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a57a56cd44d68c932c229638169a8ece1"><td class="memItemLeft" align="right" valign="top"><a id="a57a56cd44d68c932c229638169a8ece1"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapollo_1_1cyber_1_1logger_1_1AsyncLogger.html#a57a56cd44d68c932c229638169a8ece1">Start</a> ()</td></tr>
<tr class="memdesc:a57a56cd44d68c932c229638169a8ece1"><td class="mdescLeft">&#160;</td><td class="mdescRight">start the async logger <br /></td></tr>
<tr class="separator:a57a56cd44d68c932c229638169a8ece1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36aceb58b08edfba1417d18d60996811"><td class="memItemLeft" align="right" valign="top"><a id="a36aceb58b08edfba1417d18d60996811"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapollo_1_1cyber_1_1logger_1_1AsyncLogger.html#a36aceb58b08edfba1417d18d60996811">Stop</a> ()</td></tr>
<tr class="memdesc:a36aceb58b08edfba1417d18d60996811"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop the thread. <a class="el" href="classapollo_1_1cyber_1_1logger_1_1AsyncLogger.html#a75894f5de117c03d05c013f2638639a1" title="Flush any buffered messages.">Flush()</a> and <a class="el" href="classapollo_1_1cyber_1_1logger_1_1AsyncLogger.html#abe281a699f379c7274ef0fc9fe171eab" title="Write a message to the log. Start() must have been called.">Write()</a> must not be called after this. NOTE: this is currently only used in tests: in real life, we enable async logging once when the program starts and then never disable it. REQUIRES: <a class="el" href="classapollo_1_1cyber_1_1logger_1_1AsyncLogger.html#a57a56cd44d68c932c229638169a8ece1" title="start the async logger">Start()</a> must have been called. <br /></td></tr>
<tr class="separator:a36aceb58b08edfba1417d18d60996811"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe281a699f379c7274ef0fc9fe171eab"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapollo_1_1cyber_1_1logger_1_1AsyncLogger.html#abe281a699f379c7274ef0fc9fe171eab">Write</a> (bool force_flush, time_t timestamp, const char *message, int message_len) override</td></tr>
<tr class="memdesc:abe281a699f379c7274ef0fc9fe171eab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write a message to the log. <a class="el" href="classapollo_1_1cyber_1_1logger_1_1AsyncLogger.html#a57a56cd44d68c932c229638169a8ece1" title="start the async logger">Start()</a> must have been called.  <a href="classapollo_1_1cyber_1_1logger_1_1AsyncLogger.html#abe281a699f379c7274ef0fc9fe171eab">More...</a><br /></td></tr>
<tr class="separator:abe281a699f379c7274ef0fc9fe171eab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75894f5de117c03d05c013f2638639a1"><td class="memItemLeft" align="right" valign="top"><a id="a75894f5de117c03d05c013f2638639a1"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapollo_1_1cyber_1_1logger_1_1AsyncLogger.html#a75894f5de117c03d05c013f2638639a1">Flush</a> () override</td></tr>
<tr class="memdesc:a75894f5de117c03d05c013f2638639a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flush any buffered messages. <br /></td></tr>
<tr class="separator:a75894f5de117c03d05c013f2638639a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af14fc46b26821895b40def530a4a5aeb"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapollo_1_1cyber_1_1logger_1_1AsyncLogger.html#af14fc46b26821895b40def530a4a5aeb">LogSize</a> () override</td></tr>
<tr class="memdesc:af14fc46b26821895b40def530a4a5aeb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current LOG file size. The return value is an approximate value since some logged data may not have been flushed to disk yet.  <a href="classapollo_1_1cyber_1_1logger_1_1AsyncLogger.html#af14fc46b26821895b40def530a4a5aeb">More...</a><br /></td></tr>
<tr class="separator:af14fc46b26821895b40def530a4a5aeb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2e076653b98ccc604771d372f2f9c1c"><td class="memItemLeft" align="right" valign="top">std::thread *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classapollo_1_1cyber_1_1logger_1_1AsyncLogger.html#ac2e076653b98ccc604771d372f2f9c1c">LogThread</a> ()</td></tr>
<tr class="memdesc:ac2e076653b98ccc604771d372f2f9c1c"><td class="mdescLeft">&#160;</td><td class="mdescRight">get the log thead  <a href="classapollo_1_1cyber_1_1logger_1_1AsyncLogger.html#ac2e076653b98ccc604771d372f2f9c1c">More...</a><br /></td></tr>
<tr class="separator:ac2e076653b98ccc604771d372f2f9c1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Wrapper for a glog <a class="el" href="classapollo_1_1cyber_1_1logger_1_1Logger.html">Logger</a> which asynchronously writes log messages. This class starts a new thread responsible for forwarding the messages to the logger, and performs double buffering. Writers append to the current buffer and then wake up the logger thread. The logger swaps in a new buffer and writes any accumulated messages to the wrapped <a class="el" href="classapollo_1_1cyber_1_1logger_1_1Logger.html">Logger</a>. </p>
<p>This double-buffering design dramatically improves performance, especially for logging messages which require flushing the underlying file (i.e WARNING and above for default). The flush can take a couple of milliseconds, and in some cases can even block for hundreds of milliseconds or more. With the double-buffered approach, threads can proceed with useful work while the IO thread blocks.</p>
<p>The semantics provided by this wrapper are slightly weaker than the default glog semantics. By default, glog will immediately (synchronously) flush WARNING and above to the underlying file, whereas here we are deferring that flush to a separate thread. This means that a crash just after a 'LOG_WARN' would may be missing the message in the logs, but the perf benefit is probably worth it. We do take care that a glog FATAL message flushes all buffered log messages before exiting.</p>
<dl class="section warning"><dt>Warning</dt><dd>The logger limits the total amount of buffer space, so if the underlying log blocks for too long, eventually the threads generating the log messages will block as well. This prevents runaway memory usage. </dd></dl>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="af14fc46b26821895b40def530a4a5aeb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af14fc46b26821895b40def530a4a5aeb">&#9670;&nbsp;</a></span>LogSize()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t apollo::cyber::logger::AsyncLogger::LogSize </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the current LOG file size. The return value is an approximate value since some logged data may not have been flushed to disk yet. </p>
<dl class="section return"><dt>Returns</dt><dd>the log file size </dd></dl>

</div>
</div>
<a id="ac2e076653b98ccc604771d372f2f9c1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2e076653b98ccc604771d372f2f9c1c">&#9670;&nbsp;</a></span>LogThread()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::thread* apollo::cyber::logger::AsyncLogger::LogThread </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>get the log thead </p>
<dl class="section return"><dt>Returns</dt><dd>the pointer of log thread </dd></dl>

</div>
</div>
<a id="abe281a699f379c7274ef0fc9fe171eab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe281a699f379c7274ef0fc9fe171eab">&#9670;&nbsp;</a></span>Write()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void apollo::cyber::logger::AsyncLogger::Write </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>force_flush</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&#160;</td>
          <td class="paramname"><em>timestamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>message_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Write a message to the log. <a class="el" href="classapollo_1_1cyber_1_1logger_1_1AsyncLogger.html#a57a56cd44d68c932c229638169a8ece1" title="start the async logger">Start()</a> must have been called. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">force_flush</td><td>is set by the GLog library based on the configured '&ndash;logbuflevel' flag. Any messages logged at the configured level or higher result in 'force_flush' being set to true, indicating that the message should be immediately written to the log rather than buffered in memory. </td></tr>
    <tr><td class="paramname">timestamp</td><td>is the time of write a message </td></tr>
    <tr><td class="paramname">message</td><td>is the info to be written </td></tr>
    <tr><td class="paramname">message_len</td><td>is the length of message </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>cyber/logger/<a class="el" href="async__logger_8h_source.html">async_logger.h</a></li>
<li>cyber/logger/async_logger.cc</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
