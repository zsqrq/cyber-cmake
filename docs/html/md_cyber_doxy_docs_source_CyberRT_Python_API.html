<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cyber-Cmake: Python API tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cyber-Cmake
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Python API tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md136"></a>
1. Background</h1>
<p>The core functions of Cyber RT are developed in C++. We also provide more python interfaces to help developers build their own utilities for specific projects.</p>
<h1><a class="anchor" id="autotoc_md137"></a>
2. Cyber RT Python Interfaces</h1>
<p>The python interfaces of Cyber RT are wrapper the corresponding C++ interfaces. The implementation doesn't rely on other third-party tools, e.g. swig, which makes it easier to maintain.</p>
<h1><a class="anchor" id="autotoc_md138"></a>
3. Overview of Python Interfaces in Cyber RT</h1>
<p>So far, the python interfaces covers:</p>
<ul>
<li>access the information of channels</li>
<li>server/client communication</li>
<li>query informatoin in record files</li>
<li>read and write from/to record files</li>
<li>Time/Duration/Rate related operations</li>
<li>Timer</li>
</ul>
<h2><a class="anchor" id="autotoc_md139"></a>
3.1 Read/Write of Channels</h2>
<p>Steps shown as below:</p><ol type="1">
<li>First create a Node；</li>
<li>Create corresponding reader or writer;</li>
<li>If write to a channel, use write interface in writer.</li>
<li>If read from a channel, use the spin interface in the node, and process the messages in your callback function</li>
</ol>
<p>The interfaces are shown below:</p>
<div class="fragment"><div class="line">class Node:</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    Class for cyber Node wrapper.</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line"> </div>
<div class="line">    def create_writer(self, name, data_type, qos_depth=1):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        create a topic writer for send message to topic.</div>
<div class="line">        @param self</div>
<div class="line">        @param name str: topic name</div>
<div class="line">        @param data_type proto: message class for serialization</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line"> </div>
<div class="line">   def create_reader(self, name, data_type, callback, args=None):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        create a topic reader for receive message from topic.</div>
<div class="line">        @param self</div>
<div class="line">        @param name str: topic name</div>
<div class="line">        @param data_type proto: message class for serialization</div>
<div class="line">        @callback fn: function to call (fn(data)) when data is</div>
<div class="line">                   received. If args is set, the function must</div>
<div class="line">                   accept the args as a second argument,</div>
<div class="line">                   i.e. fn(data, args)</div>
<div class="line">        @args any: additional arguments to pass to the callback</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">    def create_client(self, name, request_data_type, response_data_type):</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    def create_service(self, name, req_data_type, res_data_type, callback, args=None):</div>
<div class="line"> </div>
<div class="line">    def spin(self):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        spin in wait and process message.</div>
<div class="line">        @param self</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line"> </div>
<div class="line">class Writer(object):</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    Class for cyber writer wrapper.</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    def write(self, data):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        writer msg string</div>
<div class="line">        &quot;&quot;&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md140"></a>
3.2 Record Interfaces</h2>
<p>Read from record：</p>
<ol type="1">
<li>Create a RecordReader;</li>
<li>Read messages from Record;</li>
</ol>
<p>Write to record：</p>
<ol type="1">
<li>Create a RecordWriter</li>
<li>Write messages to record；</li>
</ol>
<p>The interfaces are shown below:</p>
<div class="fragment"><div class="line">class RecordReader(object):</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    Class for cyber RecordReader wrapper.</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    def read_messages(self, start_time=0, end_time=18446744073709551615):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        read message from bag file.</div>
<div class="line">        @param self</div>
<div class="line">        @param start_time:</div>
<div class="line">        @param end_time:</div>
<div class="line">        @return: generator of (message, data_type, timestamp)</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">    def get_messagenumber(self, channel_name):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        return message count.</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">    def get_messagetype(self, channel_name):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        return message type.</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">    def get_protodesc(self, channel_name):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        return message protodesc.</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">    def get_headerstring(self):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        return message header string.</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">    def reset(self):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        return reset.</div>
<div class="line">        &quot;&quot;</div>
<div class="line">        return _CYBER_RECORD.PyRecordReader_Reset(self.record_reader)</div>
<div class="line"> </div>
<div class="line">    def get_channellist(self):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        return channel list.</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        return _CYBER_RECORD.PyRecordReader_GetChannelList(self.record_reader)</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">class RecordWriter(object):</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    Class for cyber RecordWriter wrapper.</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    def open(self, path):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        open record file for write.</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">    def write_channel(self, channel_name, type_name, proto_desc):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        writer channel by channelname,typename,protodesc</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">    def write_message(self, channel_name, data, time, raw = True):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        writer msg:channelname,data,time,is data raw</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line"> </div>
<div class="line">    def set_size_fileseg(self, size_kilobytes):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        return filesegment size.</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line"> </div>
<div class="line">    def set_intervaltime_fileseg(self, time_sec):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        return file interval time.</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line"> </div>
<div class="line">    def get_messagenumber(self, channel_name):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        return message count.</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line"> </div>
<div class="line">    def get_messagetype(self, channel_name):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        return message type.</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line"> </div>
<div class="line">    def get_protodesc(self, channel_name):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        return message protodesc.</div>
<div class="line">        &quot;&quot;&quot;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md141"></a>
3.3 Time Interfaces</h2>
<div class="fragment"><div class="line">class Time(object):</div>
<div class="line">    @staticmethod</div>
<div class="line">    def now():</div>
<div class="line">        time_now = Time(_CYBER_TIME.PyTime_now())</div>
<div class="line">        return time_now</div>
<div class="line"> </div>
<div class="line">    @staticmethod</div>
<div class="line">    def mono_time():</div>
<div class="line">        mono_time = Time(_CYBER_TIME.PyTime_mono_time())</div>
<div class="line">        return mono_time</div>
<div class="line"> </div>
<div class="line">    def to_sec(self):</div>
<div class="line">        return _CYBER_TIME.PyTime_to_sec(self.time)</div>
<div class="line"> </div>
<div class="line">    def to_nsec(self):</div>
<div class="line">        return _CYBER_TIME.PyTime_to_nsec(self.time)</div>
<div class="line"> </div>
<div class="line">    def sleep_until(self, nanoseconds):</div>
<div class="line">        return _CYBER_TIME.PyTime_sleep_until(self.time, nanoseconds)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md142"></a>
3.4 Timer Interfaces</h2>
<div class="fragment"><div class="line">class Timer(object):</div>
<div class="line"> </div>
<div class="line">    def set_option(self, period, callback, oneshot=0):</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line">        set the option of timer.</div>
<div class="line">        @param period The period of the timer, unit is ms.</div>
<div class="line">        @param callback The tasks that the timer needs to perform.</div>
<div class="line">        @param oneshot 1:perform the callback only after the first timing cycle</div>
<div class="line">        0:perform the callback every timed period</div>
<div class="line">        &quot;&quot;&quot;</div>
<div class="line"> </div>
<div class="line">    def start(self):</div>
<div class="line"> </div>
<div class="line">    def stop(self):</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md143"></a>
4. Examples</h1>
<h2><a class="anchor" id="autotoc_md144"></a>
4.1 Read from Channel (in cyber/python/examples/listener.py)</h2>
<div class="fragment"><div class="line">import sys</div>
<div class="line">sys.path.append(&quot;../&quot;)</div>
<div class="line">from cyber_py import cyber</div>
<div class="line">from modules.common.util.testdata.simple_pb2 import SimpleMessage</div>
<div class="line"> </div>
<div class="line">def callback(data):</div>
<div class="line"> </div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    reader message callback.</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    print &quot;=&quot;*80</div>
<div class="line">    print &quot;py:reader callback msg-&gt;:&quot;</div>
<div class="line">    print data</div>
<div class="line">    print &quot;=&quot;*80</div>
<div class="line"> </div>
<div class="line">def test_listener_class():</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    reader message.</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    print &quot;=&quot; * 120</div>
<div class="line">    test_node = cyber.Node(&quot;listener&quot;)</div>
<div class="line">    test_node.create_reader(&quot;channel/chatter&quot;,</div>
<div class="line">            SimpleMessage, callback)</div>
<div class="line">    test_node.spin()</div>
<div class="line"> </div>
<div class="line">if __name__ == &#39;__main__&#39;:</div>
<div class="line"> </div>
<div class="line">    cyber.init()</div>
<div class="line">    test_listener_class()</div>
<div class="line">    cyber.shutdown()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md145"></a>
4.2 Write to Channel(in cyber/python/examples/talker.py)</h2>
<div class="fragment"><div class="line">from modules.common.util.testdata.simple_pb2 import SimpleMessage</div>
<div class="line">from cyber_py import cyber</div>
<div class="line">&quot;&quot;&quot;Module for example of talker.&quot;&quot;&quot;</div>
<div class="line">import time</div>
<div class="line">import sys</div>
<div class="line">sys.path.append(&quot;../&quot;)</div>
<div class="line"> </div>
<div class="line">def test_talker_class():</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    test talker.</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    msg = SimpleMessage()</div>
<div class="line">    msg.text = &quot;talker:send Alex!&quot;</div>
<div class="line">    msg.integer = 0</div>
<div class="line">    test_node = cyber.Node(&quot;node_name1&quot;)</div>
<div class="line">    g_count = 1</div>
<div class="line">    writer = test_node.create_writer(&quot;channel/chatter&quot;,</div>
<div class="line">                                     SimpleMessage, 6)</div>
<div class="line">    while not cyber.is_shutdown():</div>
<div class="line">        time.sleep(1)</div>
<div class="line">        g_count = g_count + 1</div>
<div class="line">        msg.integer = g_count</div>
<div class="line">        print &quot;=&quot;*80</div>
<div class="line">        print &quot;write msg -&gt; %s&quot; % msg</div>
<div class="line">        writer.write(msg)</div>
<div class="line"> </div>
<div class="line">if __name__ == &#39;__main__&#39;:</div>
<div class="line">    cyber.init()</div>
<div class="line">    test_talker_class()</div>
<div class="line">    cyber.shutdown()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md146"></a>
4.3 Read and Write Messages from/to Record File(in cyber/python/examples/record.py)</h2>
<div class="fragment"><div class="line">&quot;&quot;&quot;Module for example of record.&quot;&quot;&quot;</div>
<div class="line"> </div>
<div class="line">import time</div>
<div class="line">import sys</div>
<div class="line"> </div>
<div class="line">sys.path.append(&quot;../&quot;)</div>
<div class="line">from cyber_py import cyber</div>
<div class="line">from cyber_py import record</div>
<div class="line">from google.protobuf.descriptor_pb2 import FileDescriptorProto</div>
<div class="line">from modules.common.util.testdata.simple_pb2 import SimpleMessage</div>
<div class="line"> </div>
<div class="line">TEST_RECORD_FILE = &quot;test02.record&quot;</div>
<div class="line">CHAN_1 = &quot;channel/chatter&quot;</div>
<div class="line">CHAN_2 = &quot;/test2&quot;</div>
<div class="line">MSG_TYPE = &quot;apollo.common.util.test.SimpleMessage&quot;</div>
<div class="line">STR_10B = &quot;1234567890&quot;</div>
<div class="line">TEST_FILE = &quot;test.record&quot;</div>
<div class="line"> </div>
<div class="line">def test_record_writer(writer_path):</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    record writer.</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    fwriter = record.RecordWriter()</div>
<div class="line">    if not fwriter.open(writer_path):</div>
<div class="line">        print &quot;writer open failed!&quot;</div>
<div class="line">        return</div>
<div class="line">    print &quot;+++ begin to writer...&quot;</div>
<div class="line">    fwriter.write_channel(CHAN_1, MSG_TYPE, STR_10B)</div>
<div class="line">    fwriter.write_message(CHAN_1, STR_10B, 1000)</div>
<div class="line"> </div>
<div class="line">    msg = SimpleMessage()</div>
<div class="line">    msg.text = &quot;AAAAAA&quot;</div>
<div class="line"> </div>
<div class="line">    file_desc = msg.DESCRIPTOR.file</div>
<div class="line">    proto = FileDescriptorProto()</div>
<div class="line">    file_desc.CopyToProto(proto)</div>
<div class="line">    proto.name = file_desc.name</div>
<div class="line">    desc_str = proto.SerializeToString()</div>
<div class="line"> </div>
<div class="line">    fwriter.write_channel(&#39;chatter_a&#39;, msg.DESCRIPTOR.full_name, desc_str)</div>
<div class="line">    fwriter.write_message(&#39;chatter_a&#39;, msg, 998, False)</div>
<div class="line">    fwriter.write_message(&quot;chatter_a&quot;, msg.SerializeToString(), 999)</div>
<div class="line"> </div>
<div class="line">    fwriter.close()</div>
<div class="line"> </div>
<div class="line">def test_record_reader(reader_path):</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    record reader.</div>
<div class="line">    &quot;&quot;&quot;</div>
<div class="line">    freader = record.RecordReader(reader_path)</div>
<div class="line">    time.sleep(1)</div>
<div class="line">    print &quot;+&quot;*80</div>
<div class="line">    print &quot;+++begin to read...&quot;</div>
<div class="line">    count = 1</div>
<div class="line">    for channelname, msg, datatype, timestamp in freader.read_messages():</div>
<div class="line">        print &quot;=&quot;*80</div>
<div class="line">        print &quot;read [%d] msg&quot; % count</div>
<div class="line">        print &quot;chnanel_name -&gt; %s&quot; % channelname</div>
<div class="line">        print &quot;msg -&gt; %s&quot; % msg</div>
<div class="line">        print &quot;msgtime -&gt; %d&quot; % timestamp</div>
<div class="line">        print &quot;msgnum -&gt; %d&quot; % freader.get_messagenumber(channelname)</div>
<div class="line">        print &quot;msgtype -&gt; %s&quot; % datatype</div>
<div class="line">        count = count + 1</div>
<div class="line"> </div>
<div class="line">if __name__ == &#39;__main__&#39;:</div>
<div class="line">    cyber.init()</div>
<div class="line">    test_record_writer(TEST_RECORD_FILE)</div>
<div class="line">    test_record_reader(TEST_RECORD_FILE)</div>
<div class="line">    cyber.shutdown()</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
